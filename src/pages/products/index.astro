---
/**
 * Listado de Productos - Mini-CRM SoftControl
 */
import Layout from '../../layouts/Layout.astro';
import { productService } from '../../lib/services/productService';

let products = [];
let error = null;

try {
  products = await productService.getAll();
} catch (e) {
  console.error('Error al obtener productos:', e);
  error = 'No se pudieron cargar los productos.';
}
---

<Layout title="Productos - SoftControl CRM">
  <div class="container">
    <div class="page-header">
      <h1 class="page-title">Productos</h1>
      <a href="/products/new" class="btn-primary">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width: 1.25rem; height: 1.25rem;">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
        Nuevo Producto
      </a>
    </div>

    {error && (
      <div class="alert alert-error">{error}</div>
    )}

    {!error && products.length === 0 && (
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="empty-icon">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
        </svg>
        <h3>No hay productos registrados</h3>
        <p>Comienza creando tu primer producto</p>
        <a href="/products/new" class="btn-primary" style="margin-top: 1rem;">Crear Producto</a>
      </div>
    )}

    {!error && products.length > 0 && (
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Descripción</th>
              <th>Precio Único</th>
              <th>Precio Suscripción</th>
              <th>Fecha de Registro</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            {products.map(product => (
              <tr>
                <td><strong>{product.name}</strong></td>
                <td>{product.description || '-'}</td>
                <td>{product.price_one_payment.toFixed(2)} €</td>
                <td>{product.price_subscription.toFixed(2)} €/mes</td>
                <td>{new Date(product.created_at).toLocaleDateString('es-ES')}</td>
                <td>
                  <div class="actions">
                    <a href={`/products/${product.id}/edit`} class="btn-action" title="Editar">
                      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" />
                      </svg>
                    </a>
                  </div>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    )}
  </div>
</Layout>

<style>
  .btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--radius);
    font-weight: 600;
    font-size: 0.9375rem;
    text-decoration: none;
    transition: var(--transition);
  }

  .btn-primary:hover {
    background: var(--color-primary-dark);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
    color: white;
  }

  .alert-error {
    padding: 1rem;
    border-radius: var(--radius);
    margin-bottom: 1.5rem;
    background: #fee2e2;
    color: #991b1b;
    border: 1px solid #fca5a5;
  }

  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border: 1px solid var(--color-border);
    border-radius: var(--radius-lg);
  }

  .empty-icon {
    width: 4rem;
    height: 4rem;
    color: var(--color-text-muted);
    margin: 0 auto 1rem;
  }

  .empty-state h3 {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--color-text);
  }

  .empty-state p {
    color: var(--color-text-light);
    margin-bottom: 1rem;
  }

  .actions {
    display: flex;
    gap: 0.5rem;
  }

  .btn-action {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--color-text-light);
    transition: var(--transition);
  }

  .btn-action:hover {
    background: var(--color-bg-alt);
    color: var(--color-primary);
  }

  .btn-action svg {
    width: 1.25rem;
    height: 1.25rem;
  }
</style>
